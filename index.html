<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Special Question for Chloe</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
    :root {
        --bpm-speed: 0.4878s; /* 123 BPM */
        --neon-color: #ff7675;
    }

    /* GLOBAL HEART CURSOR */
    html, body, .sketch-container, button, .btn, a, input {
        cursor: url('assets/heart.png') 16 16, auto !important;
    }

    /* SCROLL FIXES */
    html {
        scroll-behavior: smooth;
    }

    body {
        margin: 0; padding: 0; 
        min-height: 100vh;
        display: flex; justify-content: center; align-items: flex-start; 
        background-color: #a0cfee; 
        /* Allow vertical scrolling, hide horizontal */
        overflow-x: hidden;
        overflow-y: auto; 
        font-family: "Times New Roman", Times, serif;
        font-size: 15px;
    }

    .anime-bg-layer {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        background-image: url('assets/anime-bg.jpg'); 
        background-size: cover; background-position: center; opacity: 0.5;
        transition: background-image 0.5s ease-in-out;
    }

    #introPic {
        width: 100%; max-height: 180px; object-fit: cover;
        border-radius: 10px; border: 2px solid #000;
        margin-bottom: 20px; animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }

    .sketch-container {
        background: rgba(255, 255, 255, 0.95);
        padding: 40px; border-radius: 15px;
        border: 4px solid #000; text-align: center;
        position: relative; z-index: 10;
        width: 550px; max-width: 90%; 
        margin-top: 10vh; margin-bottom: 10vh; /* Added margin for bottom-scroll space */
        min-height: 520px; display: flex; flex-direction: column;
        animation: neonPulse var(--bpm-speed) ease-in-out infinite;
    }

    @keyframes neonPulse {
        0%, 100% { box-shadow: 0 0 10px var(--neon-color), 10px 10px 0 0 rgba(0,0,0,0.2); }
        50% { box-shadow: 0 0 25px var(--neon-color), 10px 10px 0 0 rgba(0,0,0,0.2); }
    }

    .glitch-text { position: relative; display: inline-block; }
    .glitch-text:hover {
        animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
        color: #d63031;
    }

    @keyframes glitch {
        0% { transform: translate(0); }
        20% { transform: translate(-3px, 3px); }
        40% { transform: translate(-3px, -3px); }
        60% { transform: translate(3px, 3px); }
        80% { transform: translate(3px, -3px); }
        100% { transform: translate(0); }
    }

    .typing-mask { border-right: 2px solid var(--neon-color); white-space: pre-wrap; }

    /* OVERLAYS */
    #videoOverlay, #confirmOverlay, #wrongPopupOverlay, #homeConfirmOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); display: none; justify-content: center;
        align-items: center; z-index: 6000; flex-direction: column;
    }

    .modal-box {
        background: white; padding: 30px; border: 4px solid #000;
        border-radius: 10px; text-align: center; width: 380px;
        box-shadow: 8px 8px 0 var(--neon-color);
    }

    #pastaVideo { width: 70vw; max-width: 594px; aspect-ratio: 594 / 420; border: 5px solid #fff; border-radius: 5px; }

    .btn {
        padding: 12px 25px; font-size: 1.3em; cursor: pointer;
        border: 3px solid #000; background: white; border-radius: 15px;
        font-family: "Times New Roman", Times, serif;
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); margin: 5px;
    }

    #yesBtn { background-color: #ffdde1; color: #d63031; }
    #noBtn { background-color: #dfe6e9; color: #636e72; }

    #musicToggle {
        position: fixed; bottom: 20px; right: 20px; z-index: 2000;
        background: white; border: 2px solid #000; padding: 10px 20px;
        border-radius: 50px; font-size: 0.9em; cursor: pointer; display: none;
    }

    .nav-container { display: flex; justify-content: space-between; align-items: center; margin-top: auto; border-top: 2px dashed #ccc; padding-top: 15px; }
    .step { display: none; flex-direction: column; height: 100%; }
    .active-step { display: flex; }

    /* AUTH SCREEN SPECIFIC */
    #authInput {
        padding: 15px; font-size: 1.5em; border: 3px solid #000;
        border-radius: 10px; width: 80%; margin: 20px auto;
        text-align: center; font-family: monospace;
    }

    #proofImage { width: 100%; max-height: 200px; object-fit: contain; margin-bottom: 10px; display: none; border: 2px solid #333; }
    .final-pics { position: relative; display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 30px; min-height: 250px; }
    .final-pics img { width: 160px; height: auto; border: 4px solid #000; border-radius: 10px; }
    .float-1 { animation: floating 3s ease-in-out infinite; }
    .float-2 { animation: floating 4s ease-in-out infinite; animation-delay: 0.5s; }
    .float-3 { animation: floating 3.5s ease-in-out infinite; animation-delay: 1s; }

    @keyframes floating { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-15px); } }
    .shake { animation: shake 0.4s; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
</style>
</head>
<body>

    <div class="anime-bg-layer" id="bgLayer"></div>
    <audio id="bgMusic"><source src="assets/song.mp3" type="audio/mpeg"></audio>
    <button id="musicToggle" onclick="toggleMusic()">üîä Pause Music</button>

    <div id="stepLogin" class="step active-step" style="justify-content: center; padding-bottom: 50px;">
        <div class="sketch-container" style="min-height: 350px;">
            <h1 class="glitch-text">üîí ACCESS RESTRICTED</h1>
            <p>Authentication Required. Please enter the Encryption Key to access 'Valentine_Project_2026'</p>
            <input type="password" id="authInput" placeholder="Enter Key...">
            <button class="btn" onclick="checkAuth()">Authenticate</button>
            <p id="authError" style="color: #d63031; font-weight: bold; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="homeConfirmOverlay">
        <div class="modal-box">
            <h2 style="color:#d63031;">‚ö†Ô∏è SYSTEM RESET</h2>
            <p>Do you want to restart everything? (Security gate will remain unlocked)</p>
            <button class="btn" onclick="fullSystemReset()" style="background:#ff7675; color:white;">Yes, Reset</button>
            <button class="btn" onclick="closeHomeConfirm()">Cancel</button>
        </div>
    </div>

    <div id="confirmOverlay">
        <div class="modal-box">
            <h2 style="color:#d63031;">‚ö†Ô∏è SECURITY WARNING</h2>
            <p>Accessing 'No' choice may leak sensitive pasta footage.</p>
            <button class="btn" onclick="confirmNo(true)" style="background:#ff7675; color:white;">Proceed</button>
            <button class="btn" onclick="confirmNo(false)">Cancel</button>
        </div>
    </div>

    <div id="wrongPopupOverlay">
        <div class="modal-box">
            <h2 style="color:#d63031;">‚ùå ERROR DETECTED</h2>
            <p id="wrongPopupText" style="font-size: 1.2em;"></p>
            <button class="btn" onclick="closeWrongPopup()">Re-authenticate ‚Üª</button>
        </div>
    </div>

    <div id="videoOverlay">
        <h2 id="videoRoastText" style="color:white; margin-bottom:20px;"></h2>
        <video id="pastaVideo" playsinline><source src="assets/pasta.mp4" type="video/mp4"></video>
    </div>

    <div class="sketch-container" id="mainBox" style="display:none;">
        <div id="step0" class="step">
            <img src="assets/intro.jpeg" id="introPic">
            <h1 class="glitch-text" style="font-size: 2.2em;">Chloe, Will you be my Valentine? (‚óï‚Äø‚óï)</h1>
            <div style="height: 100px; display: flex; justify-content: center; align-items: center; gap: 30px;">
                <button class="btn" id="yesBtn">YES!</button>
                <button class="btn glitch-text" id="noBtn" onclick="initiateNoProcess()">No</button>
            </div>
        </div>

        <div id="step1" class="step">
            <h2 style="color: #ff4757;">I knew you would say yes üòâ</h2>
            <p>Ready for the quiz? We gotta check you first tho ‚ù§Ô∏è</p>
            <button class="btn" onclick="goToStep(2)">Start Quiz! ‚úèÔ∏è</button>
            <div class="nav-container"><button class="btn" style="font-size:0.8em;" onclick="triggerHomeConfirm()">üè† Home</button></div>
        </div>

        <div id="step2" class="step">
            <img id="proofImage" src="">
            <h3 id="questionText" class="typing-mask"></h3>
            <div id="choices" style="display: flex; flex-direction: column;"></div>
            <p id="msgDisplay" style="color: #636e72; font-style: italic; min-height: 2em;"></p>
            <div class="nav-container">
                <button class="btn" style="font-size:0.8em;" id="backBtn" onclick="prevQuizQuestion()">‚Üê Back</button>
                <button class="btn" style="font-size:0.7em; background:#eee;" onclick="triggerHomeConfirm()">üè† Home</button>
                <button class="btn" id="nextBtn" style="font-size:0.8em; visibility:hidden;" onclick="nextQuizQuestion()">Next ‚Üí</button>
            </div>
        </div>

        <div id="step3" class="step">
            <h2 style="color: #ff4757;">Thank you for being the best Valentine ever now and forever ‚ù§Ô∏è</h2>
            <div class="final-pics">
                <img src="assets/us1.jpeg" class="float-1">
                <img src="assets/us2.jpeg" class="float-2">
                <img src="assets/us3.jpeg" class="float-3">
            </div>
            <div class="nav-container">
                <button class="btn" style="font-size:0.8em;" onclick="goToStep(2)">‚Üê Back to Quiz</button>
                <button class="btn" style="font-size:0.7em; background:#eee;" onclick="triggerHomeConfirm()">üè† Home</button>
            </div>
        </div>
    </div>

<script>
    // --- SET YOUR PASSWORD HERE ---
    const encryptionKey = "CHLOE2026"; 

    function checkAuth() {
        const input = document.getElementById('authInput').value;
        const error = document.getElementById('authError');
        const loginStep = document.getElementById('stepLogin');
        const mainApp = document.getElementById('mainBox');

        if (input.toUpperCase() === encryptionKey.toUpperCase()) {
            loginStep.style.display = 'none';
            mainApp.style.display = 'flex';
            goToStep(0);
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        } else {
            error.innerText = "‚ùå ACCESS DENIED: Invalid Encryption Key";
            document.getElementById('stepLogin').querySelector('.sketch-container').classList.add('shake');
            setTimeout(() => { document.getElementById('stepLogin').querySelector('.sketch-container').classList.remove('shake'); }, 400);
        }
    }

    // Allow 'Enter' key to login
    document.getElementById('authInput').addEventListener("keypress", function(event) {
        if (event.key === "Enter") { event.preventDefault(); checkAuth(); }
    });

    const playlist = ["assets/song.mp3", "assets/song2.mp3"];
    let currentTrackIndex = 0;
    const bgMusic = document.getElementById('bgMusic');
    bgMusic.onended = () => {
        currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
        bgMusic.src = playlist[currentTrackIndex];
        bgMusic.play();
    };

    function toggleMusic() {
        if (bgMusic.paused) { bgMusic.play(); musicToggle.innerText = "üîä Pause Music"; }
        else { bgMusic.pause(); musicToggle.innerText = "üîá Play Music"; }
    }

    const noBtn = document.getElementById('noBtn');
    const pastaVideo = document.getElementById('pastaVideo');
    const videoOverlay = document.getElementById('videoOverlay');
    const musicToggle = document.getElementById('musicToggle');
    const proofImg = document.getElementById('proofImage');

    let noClickCount = 0;
    let typingTimer = null;

    function initiateNoProcess() {
        if (noClickCount === 0) document.getElementById('confirmOverlay').style.display = 'flex';
        else processVideoLeak();
    }
    function confirmNo(confirmed) {
        document.getElementById('confirmOverlay').style.display = 'none';
        if (confirmed) processVideoLeak();
    }
    function processVideoLeak() {
        noClickCount++;
        let playTime = noClickCount === 1 ? 5000 : 10000;
        document.getElementById('videoRoastText').innerText = noClickCount === 1 ? "Unauthorized Access! 5s leak..." : "Critical Error! 10s leak incoming...";
        videoOverlay.style.display = 'flex';
        pastaVideo.currentTime = 0; pastaVideo.play();
        setTimeout(() => {
            pastaVideo.pause(); videoOverlay.style.display = 'none';
            if (noClickCount === 2) {
                noBtn.innerText = "Yes Absolutely ‚ù§Ô∏è";
                noBtn.onclick = () => { bgMusic.play(); goToStep(1); };
            }
        }, playTime);
    }

    function triggerHomeConfirm() { document.getElementById('homeConfirmOverlay').style.display = 'flex'; }
    function closeHomeConfirm() { document.getElementById('homeConfirmOverlay').style.display = 'none'; }
    function fullSystemReset() {
        closeHomeConfirm();
        noClickCount = 0; currentQ = 0;
        quizData.forEach(q => q.answered = false);
        noBtn.innerText = "No";
        noBtn.onclick = initiateNoProcess;
        bgMusic.pause(); bgMusic.currentTime = 0;
        clearInterval(typingTimer);
        goToStep(0);
        window.scrollTo(0,0);
    }

    function showWrongPopup(msg) {
        document.getElementById('wrongPopupText').innerText = msg;
        document.getElementById('wrongPopupOverlay').style.display = 'flex';
    }
    function closeWrongPopup() { document.getElementById('wrongPopupOverlay').style.display = 'none'; }

    function typeText(element, text, speed = 40) {
        clearInterval(typingTimer);
        element.innerHTML = "";
        let i = 0;
        typingTimer = setInterval(() => {
            if (i < text.length) { element.innerHTML += text.charAt(i); i++; }
            else { clearInterval(typingTimer); }
        }, speed);
    }

    function goToStep(stepNum) {
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active-step'));
        document.getElementById('step' + stepNum).classList.add('active-step');
        // Reset scroll position on step change
        window.scrollTo(0,0);
        if(stepNum === 0) musicToggle.style.display = 'none';
        else musicToggle.style.display = 'block';
        if(stepNum === 1) confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#ff7675', '#ffdde1'] });
        if(stepNum === 2) loadQuestion();
        if(stepNum === 3) confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 }, colors: ['#ff7675', '#ffffff'] });
    }

    document.getElementById('yesBtn').onclick = () => { bgMusic.play(); goToStep(1); };

    const quizData = [
        {
            q: "What is the Steam game we've played the most together?",
            options: [
                { text: "Age of Empires", msg: "Correct! üè∞", img: "assets/aoe.jpg" },
                { text: "Stardew Valley", msg: "Close, i thought this was it.", img: "assets/stardew.jpg" },
                { text: "Overcooked", msg: "I thought it had more hours.", img: "assets/overcooked.jpg" },
                { text: "Sea of Thieves", msg: "Not much tbh.", img: "assets/sea.jpg" }
            ],
            correctIndex: 0, bg: "assets/bg1.jpg", answered: false
        },
        {
            q: "Where did we go for our first date in Sri Lanka?",
            options: [
                { text: "Port City", msg: "Nope! That wasn't it." },
                { text: "One Galle Face", msg: "Not quite." },
                { text: "Fire Beach", msg: "Correct! üèñÔ∏è", img: "assets/firebeach.jpeg" },
                { text: "Lotus Tower", msg: "Wrong!" }
            ],
            correctIndex: 2, bg: "assets/bg2.jpg", answered: false
        },
        {
            q: "The first time ever we ate in, what type of food was it?",
            options: [
                { text: "Italian", msg: "Nope." },
                { text: "Japanese", msg: "Correct! üç£", img: "assets/japanese.jpg" },
                { text: "Chinese", msg: "Close but no." },
                { text: "American", msg: "Wrong." }
            ],
            correctIndex: 1, bg: "assets/bg3.jpg", answered: false
        },
        {
            q: "What was the exact story reply I sent to you on IG after we met?",
            options: [
                { text: "Hows the hangover chloe? ", msg: "Correct! No apostrophe. üòÇ", img: "assets/ig_reply.jpeg" },
                { text: "How's the hangover chloe?", msg: "So close! No apostrophe used." },
                { text: "Hows the hangover chloe", msg: "Check punctuation!" },
                { text: "How's the hangover chloe?üòÇ", msg: "Too much energy." }
            ],
            correctIndex: 0, bg: "assets/bg4.jpg", answered: false
        },
        {
            q: "What was the first thing i posted about us?",
            options: [
                { text: "Holey Moley Adelaide", msg: "Nope." },
                { text: "Korean BBQ Adelaide", msg: "I wish." },
                { text: "Art Museum Adelaide", msg: "Correct! üé®", img: "assets/art_museum.jpeg" },
                { text: "Arcade in Holey Moley", msg: "Almost." }
            ],
            correctIndex: 2, bg: "assets/bg5.jpg", answered: false
        },
        {
            q: "What is the first ever gift I got you?",
            options: [
                { text: "Flowers", msg: "Classic, but not the first." },
                { text: "Chocolate", msg: "Correct! üç´", img: "assets/choc_gift.jpg" },
                { text: "Necklace", msg: "Not the first." },
                { text: "Bracelet", msg: "Later on." }
            ],
            correctIndex: 1, bg: "assets/bg6.jpg", answered: false
        },
        {
            q: "What was the third song we added to OUR Spotify playlist?",
            options: [
                { text: "Red Leather", msg: "Nope." },
                { text: "I wanna be yours", msg: "Not #3." },
                { text: "Lost in the Fire", msg: "Almost!" },
                { text: "Tonight (Best You Ever Had)", msg: "Correct! üéµ", img: "assets/spotify.jpeg" }
            ],
            correctIndex: 3, bg: "assets/bg7.jpg", answered: false
        }
    ];

    let currentQ = 0;
    function loadQuestion() {
        const data = quizData[currentQ];
        typeText(document.getElementById('questionText'), data.q);
        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = "";
        document.getElementById('msgDisplay').innerText = "";
        document.getElementById('bgLayer').style.backgroundImage = `url('${data.bg}')`;
        proofImg.style.display = "none";
        const nBtn = document.getElementById('nextBtn');
        nBtn.style.visibility = data.answered ? "visible" : "hidden";

        data.options.forEach((opt, idx) => {
            const b = document.createElement('button');
            b.classList.add('btn'); b.innerText = opt.text;
            if(data.answered && idx === data.correctIndex) b.style.background = "#c2fbd7";
            b.onclick = () => {
                const isCorrect = (idx === data.correctIndex);
                if (isCorrect || currentQ === 0) {
                    proofImg.src = opt.img; proofImg.style.display = "block";
                    document.getElementById('msgDisplay').innerText = opt.msg;
                } else { proofImg.style.display = "none"; showWrongPopup(opt.msg); }
                if(isCorrect) { b.style.background = "#c2fbd7"; data.answered = true; nBtn.style.visibility = "visible"; }
                else { document.getElementById('mainBox').classList.add('shake'); setTimeout(() => document.getElementById('mainBox').classList.remove('shake'), 400); b.style.background = "#ff9999"; }
            };
            choicesDiv.appendChild(b);
        });
    }

    function nextQuizQuestion() { currentQ++; if(currentQ < quizData.length) loadQuestion(); else goToStep(3); }
    function prevQuizQuestion() { if(currentQ > 0) { currentQ--; loadQuestion(); } else goToStep(1); }
</script>
</body>
</html>